name: Keep Servers Alive

on:
  schedule:
   - cron: '0 */4 * * *' # æ¯4å°æ—¶æ‰§è¡Œä¸€æ¬¡ï¼ˆç§åº“æ¯æœˆ500åˆ†é’Ÿè¿è¡Œæ—¶é•¿ï¼Œæ¯å¤©16åˆ†é’Ÿï¼‰
  workflow_dispatch: 

jobs:
  keep_servers_alive:
    runs-on: ubuntu-latest
    env:
    # serv00å˜é‡æ·»åŠ è§„åˆ™ï¼š
    # æ¨è:ä¸ºç¡®ä¿èŠ‚ç‚¹å¯ç”¨æ€§ï¼Œå»ºè®®åœ¨Serv00ç½‘é¡µä¸è®¾ç½®ç«¯å£ï¼Œè„šæœ¬ä¼šéšæœºç”Ÿæˆæœ‰æ•ˆç«¯å£ï¼Œé¦–æ¬¡è¿è¡Œä¼šä¸­æ–­SSHï¼Œè¯·æŠŠRESè®¾ç½®ä¸ºnå†æ‰§è¡Œå³å¯
    # RES(å¿…å¡«)ï¼šnè¡¨ç¤ºæ¯æ¬¡ä¸é‡ç½®éƒ¨ç½²ï¼Œyè¡¨ç¤ºæ¯æ¬¡é‡ç½®éƒ¨ç½²ã€‚REP(å¿…å¡«)ï¼šnè¡¨ç¤ºä¸é‡ç½®éšæœºç«¯å£(ä¸‰ä¸ªç«¯å£ç•™ç©º)ï¼Œyè¡¨ç¤ºé‡ç½®ç«¯å£(ä¸‰ä¸ªç«¯å£ç•™ç©º)ã€‚SSH_USER(å¿…å¡«)è¡¨ç¤ºserv00è´¦å·åã€‚SSH_PASS(å¿…å¡«)è¡¨ç¤ºserv00å¯†ç ã€‚REALITYè¡¨ç¤ºrealityåŸŸå(ç•™ç©ºè¡¨ç¤ºserv00å®˜æ–¹åŸŸåï¼šä½ serv00è´¦å·å.serv00.net)ã€‚SUUIDè¡¨ç¤ºuuid(ç•™ç©ºè¡¨ç¤ºéšæœºuuid)ã€‚TCP1_PORTè¡¨ç¤ºvlessçš„tcpç«¯å£(ç•™ç©ºè¡¨ç¤ºéšæœºtcpç«¯å£)ã€‚TCP2_PORTè¡¨ç¤ºvmessçš„tcpç«¯å£(ç•™ç©ºè¡¨ç¤ºéšæœºtcpç«¯å£)ã€‚UDP_PORTè¡¨ç¤ºhy2çš„udpç«¯å£(ç•™ç©ºè¡¨ç¤ºéšæœºudpç«¯å£)ã€‚HOST(å¿…å¡«)è¡¨ç¤ºç™»å½•serv00æœåŠ¡å™¨åŸŸåã€‚ARGO_DOMAINè¡¨ç¤ºargoå›ºå®šåŸŸå(ç•™ç©ºè¡¨ç¤ºä¸´æ—¶åŸŸå)ã€‚ARGO_AUTHè¡¨ç¤ºargoå›ºå®šåŸŸåtoken(ç•™ç©ºè¡¨ç¤ºä¸´æ—¶åŸŸå)ã€‚
    # å¿…å¡«å˜é‡ï¼šRESã€REPã€SSH_USERã€SSH_PASSã€HOST
    # æ³¨æ„[]"",:è¿™äº›ç¬¦å·ä¸è¦ä¹±åˆ ï¼ŒæŒ‰è§„å¾‹å¯¹é½
    # æ¯è¡Œä¸€ä¸ª{serv00æœåŠ¡å™¨}ï¼Œä¸€ä¸ªæœåŠ¡ä¹Ÿå¯ï¼Œæœ«å°¾ç”¨,é—´éš”ï¼Œæœ€åä¸€ä¸ªæœåŠ¡å™¨æœ«å°¾æ— éœ€ç”¨,é—´éš”
      ACCOUNTS: >
        [
        {"RES":"y", "REP":"y", "SSH_USER":"fanniubi", "SSH_PASS":"Fb20021117@!", "REALITY":"fanniubi.serv00.net", "SUUID":"e07baef0-e04f-42e6-8755-7190c22eb75f", "TCP1_PORT":"4060", "TCP2_PORT":"29983", "UDP_PORT":"17194", "HOST":"s14.serv00.com", "vmess.608002.xyz":"", "eyJhIjoiNDhlYzJmYWMwMGJiYzk3NjAwNDM3ODAzNGZhODk0M2MiLCJ0IjoiZTY2OTQ1ZmEtMzM1ZC00MTE2LTg1ZWEtMzc1N2FkMTA1MzM4IiwicyI6Ik1UWmxNek5rWkRrdFpHUmxZUzAwTURnMExUbGhOekl0TlRnek5UYzBaVFV4WkRBMSJ9":""},
        {"RES":"y", "REP":"y", "SSH_USER":"oceanblue", "SSH_PASS":"Fb20021117!@", "REALITY":"time.is", "SUUID":"2837962f-03d6-451e-af14-3212ab39afe4", "TCP1_PORT":"54755", "TCP2_PORT":"60142", "UDP_PORT":"15300", "HOST":"s15.serv00.com", "ARGO_DOMAIN":"ä½ çš„argoå›ºå®šåŸŸå", "ARGO_AUTH":"eyJhIjoiOTM3YzFjYWI88552NTFiYTM4ZTY0ZDQzRmlNelF0TkRBd1pUQTRNVEJqTUdVeCJ9"} 
        ]
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Install required packages
        run: |
          sudo apt-get update
          sudo apt-get install -y sshpass curl jq

      - name: Process each account
        run: |
          run_remote_command() {
          local RES=$1
          local REP=$2
          local SSH_USER=$3
          local SSH_PASS=$4
          local REALITY=${5}
          local SUUID=$6
          local TCP1_PORT=$7
          local TCP2_PORT=$8
          local UDP_PORT=$9
          local HOST=${10}
          local ARGO_DOMAIN=${11}
          local ARGO_AUTH=${12}
          if [ -z "${ARGO_DOMAIN}" ]; then
          echo "ArgoåŸŸåä¸ºç©ºï¼Œç”³è¯·Argoä¸´æ—¶åŸŸå"
          else
          echo "Argoå·²è®¾ç½®å›ºå®šåŸŸåï¼š${ARGO_DOMAIN}"
          fi
          remote_command="export reym=$REALITY UUID=$SUUID vless_port=$TCP1_PORT vmess_port=$TCP2_PORT hy2_port=$UDP_PORT reset=$RES resport=$REP ARGO_DOMAIN=${ARGO_DOMAIN} ARGO_AUTH=${ARGO_AUTH} && bash <(curl -Ls https://raw.githubusercontent.com/yonggekkk/sing-box-yg/main/serv00keep.sh)"
          echo "Executing remote command on $HOST as $SSH_USER with command: $remote_command"
          sshpass -p "$SSH_PASS" ssh -o StrictHostKeyChecking=no "$SSH_USER@$HOST" "$remote_command"
           }
                 echo "*****************************************************"
                 echo "*****************************************************"
                 echo "ç”¬å“¥Githubé¡¹ç›®  ï¼šgithub.com/yonggekkk"
                 echo "ç”¬å“¥Bloggeråšå®¢ ï¼šygkkk.blogspot.com"
                 echo "ç”¬å“¥YouTubeé¢‘é“ ï¼šwww.youtube.com/@ygkkk"
                 echo "è‡ªåŠ¨è¿œç¨‹éƒ¨ç½²å¹¶ä¿æ´»Serv00ä¸‰åˆä¸€åè®®è„šæœ¬ã€Githubã€‘"
                 echo "ç‰ˆæœ¬ï¼šV25.2.26"
                 echo "*****************************************************"
                 echo "*****************************************************"
              count=0  
           for account in $(echo "${ACCOUNTS}" | jq -c '.[]'); do
              count=$((count+1))
              RES=$(echo $account | jq -r '.RES')
              REP=$(echo $account | jq -r '.REP')
              SSH_USER=$(echo $account | jq -r '.SSH_USER')
              SSH_PASS=$(echo $account | jq -r '.SSH_PASS')
              REALITY=$(echo $account | jq -r '.REALITY')
              SUUID=$(echo $account | jq -r '.SUUID')
              TCP1_PORT=$(echo $account | jq -r '.TCP1_PORT')
              TCP2_PORT=$(echo $account | jq -r '.TCP2_PORT')
              UDP_PORT=$(echo $account | jq -r '.UDP_PORT')
              HOST=$(echo $account | jq -r '.HOST')
              ARGO_DOMAIN=$(echo $account | jq -r '.ARGO_DOMAIN')
              ARGO_AUTH=$(echo $account | jq -r '.ARGO_AUTH') 
          if sshpass -p "$SSH_PASS" ssh -o StrictHostKeyChecking=no "$SSH_USER@$HOST" -q exit; then
            echo "ğŸ‰æ­å–œï¼âœ…ç¬¬ã€$countã€‘å°æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼ğŸš€æœåŠ¡å™¨åœ°å€ï¼š$HOST ï¼Œè´¦æˆ·åï¼š$SSH_USER" 
          if [ -z "${ARGO_DOMAIN}" ]; then
           check_process="ps aux | grep '[c]onfig' > /dev/null && ps aux | grep [l]ocalhost:$TCP2_PORT > /dev/null"
            else
           check_process="ps aux | grep '[c]onfig' > /dev/null && ps aux | grep '[t]oken $ARGO_AUTH' > /dev/null"
           fi
          if ! sshpass -p "$SSH_PASS" ssh -o StrictHostKeyChecking=no "$SSH_USER@$HOST" "$check_process" || [[ "$RES" =~ ^[Yy]$ ]]; then
            echo "âš ï¸æ£€æµ‹åˆ°ä¸»è¿›ç¨‹æˆ–è€…argoè¿›ç¨‹æœªå¯åŠ¨ï¼Œæˆ–è€…æ‰§è¡Œé‡ç½®"
             echo "âš ï¸ç°åœ¨å¼€å§‹ä¿®å¤æˆ–é‡ç½®éƒ¨ç½²â€¦â€¦è¯·ç¨ç­‰"
             output=$(run_remote_command "$RES" "$REP" "$SSH_USER" "$SSH_PASS" "${REALITY}" "$SUUID" "$TCP1_PORT" "$TCP2_PORT" "$UDP_PORT" "$HOST" "${ARGO_DOMAIN}" "${ARGO_AUTH}")
            echo "è¿œç¨‹å‘½ä»¤æ‰§è¡Œç»“æœï¼š$output"
          else
            echo "ğŸ‰æ­å–œï¼âœ…æ£€æµ‹åˆ°æ‰€æœ‰è¿›ç¨‹æ­£å¸¸è¿è¡Œä¸­ "
            SSH_USER_LOWER=$(echo "$SSH_USER" | tr '[:upper:]' '[:lower:]')
            sshpass -p "$SSH_PASS" ssh -o StrictHostKeyChecking=no "$SSH_USER@$HOST" "
            echo \"é…ç½®æ˜¾ç¤ºå¦‚ä¸‹ï¼š\"
            cat $HOME/domains/${SSH_USER_LOWER}.serv00.net/logs/list.txt
             echo \"====================================================\"
             "
            fi
           else
            echo "===================================================="
            echo "ğŸ’¥æ¯å…·ï¼âŒç¬¬ã€$countã€‘å°æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼ğŸš€æœåŠ¡å™¨åœ°å€ï¼š$HOST ï¼Œè´¦æˆ·åï¼š$SSH_USER"
            echo "âš ï¸å¯èƒ½è´¦å·åã€å¯†ç ã€æœåŠ¡å™¨åç§°è¾“å…¥é”™è¯¯ï¼Œæˆ–è€…å½“å‰æœåŠ¡å™¨åœ¨ç»´æŠ¤ä¸­"  
            echo "===================================================="
           fi
            done
